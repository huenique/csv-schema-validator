# CSV Schema Validator

Automated CSV schema validation framework for preventing data regressions in scraper outputs and monitoring data

[![Python 3.13](https://img.shields.io/badge/python-3.13-blue.svg)](https://www.python.org/downloads/)

## Features

- **Comprehensive Schema Validation** - Support for seller, listing, and monitoring data schemas
- **Advanced CLI Interface** - User-friendly command-line tools with detailed output
- **Integration Helpers** - Easy integration with scrapers, CI/CD pipelines, and monitoring systems
- **Batch Processing** - Validate multiple files efficiently
- **Extensible Architecture** - Add custom schemas and validation rules
- **Real-time Monitoring** - Track CSV validation metrics and alerts

## Purpose

This framework ensures that CSV files generated by web scrapers maintain consistent structure and data formats. It automatically detects:

- **Missing required columns** - Catch when expected fields disappear
- **Extra unexpected columns** - Identify schema drift  
- **Data type violations** - Ensure proper formats (UUIDs, emails, datetimes, etc.)
- **Required field violations** - Detect missing mandatory data
- **Format inconsistencies** - Validate JSON arrays, URLs, boolean values
- **Monitoring data compliance** - Validate seller monitoring and event tracking data

## Quick Start

### Installation

```bash
# Install from git submodule
git submodule add https://github.com/huenique/csv-schema-validator.git

pip install -e ./csv-schema-validator
```

### Usage

```bash
# Show schema information
csv-schema-validator info --schema-type seller
csv-schema-validator info --schema-type listing

# Validate CSV files
csv-schema-validator validate --schema-type seller --file Seller_rows.csv
csv-schema-validator validate --schema-type listing --file Listing_rows.csv
```

## Schema Support

### Core CSV Schemas

#### Seller CSV Schema (28 fields)

- Core seller identification (UUID, name, profile URLs)
- Contact information (email, phone, address)  
- Ratings and verification status
- Administrative tracking fields
- Status flags (blacklisted, counterfeiter, priority)

#### Listing CSV Schema (33 fields)

- Product identification (UUID, title, images, SKU/ASIN)
- Pricing and inventory data
- Marketplace compliance status
- Timestamps and tracking information
- Brand and category associations

### Monitoring Schemas (New!)

#### Seller Monitoring Schema (10 fields)

- Seller monitoring status tracking
- Confidence scoring for status determination
- Evidence hashing for change detection
- Marketplace-specific monitoring data

#### Seller Monitoring Events Schema (10 fields)

- Status transition tracking
- Event-driven monitoring logs
- Confidence score changes over time
- Detailed transition reasoning

## Integration Examples

### Enhanced CLI Usage

```bash
# Show detailed schema information
csv-schema-validator info --schema-type seller
csv-schema-validator info --schema-type listing

# Validate CSV files with comprehensive reporting
csv-schema-validator validate --schema-type seller --file Seller_rows.csv
csv-schema-validator validate --schema-type listing --file Listing_rows.csv

# Use monitoring schemas (NEW!)
python -m csv_schema_validator.validators validate_monitoring_data.csv
```

### Programmatic Usage

```python
from csv_schema_validator import CSVSchemaValidator, SELLER_SCHEMA
from csv_schema_validator.monitoring_schemas import SELLER_MONITORING_SCHEMA

# Validate seller data
validator = CSVSchemaValidator(SELLER_SCHEMA)
result = validator.validate_file("Seller_rows.csv")

if result.is_valid:
    print(f"‚úÖ Validation passed! {result.total_rows} rows processed")
else:
    print(f"‚ùå Found {result.error_count} errors")
    for issue in result.issues:
        print(f"  - {issue.field_name}: {issue.description}")

# Validate monitoring data (NEW!)
monitoring_validator = CSVSchemaValidator(SELLER_MONITORING_SCHEMA)
monitoring_result = monitoring_validator.validate_file("monitoring_data.csv")
```

### Advanced Integration Features

```python
# Batch validation
from csv_schema_validator import BatchValidator, SchemaTestRunner

# Validate multiple files
batch_validator = BatchValidator()
results = batch_validator.validate_directory("./csv_files", {
    "seller": SELLER_SCHEMA,
    "listing": LISTING_SCHEMA
})

# Automated test running
runner = SchemaTestRunner("./workspace")
test_results = runner.run_full_validation()

# CI/CD Integration
from csv_schema_validator.integrations.ci_cd import generate_ci_report
report = generate_ci_report(results, "validation_report.json")
```

### Post-Scraper Validation Hook

```bash
#!/bin/bash
# Enhanced validation script with monitoring support

# Run your scraper
python scraper.py

# Validate main outputs
csv-schema-validator validate --schema-type seller --file Seller_rows.csv
csv-schema-validator validate --schema-type listing --file Listing_rows.csv

# Validate monitoring data (if applicable)
if [ -f "seller_monitoring.csv" ]; then
    python -m csv_schema_validator.cli validate --schema-type monitoring --file seller_monitoring.csv
fi

# Check exit codes
if [ $? -ne 0 ]; then
    echo "‚ùå Schema validation failed - please review data quality"
    exit 1
else
    echo "‚úÖ All validation checks passed!"
fi
```

### Integration Helper Tools

```python
# Create post-scraper validation hooks
from csv_schema_validator.integrations.scrapers import create_post_scraper_hook

hook_path = create_post_scraper_hook("./my_scraper")
print(f"Created validation hook: {hook_path}")

# Set up CI/CD integration  
from csv_schema_validator.integrations.ci_cd import setup_ci_integration

setup_ci_integration("./my_project")
```

## New Features & Improvements

### üÜï Monitoring Schemas

- Dedicated schemas for seller monitoring data
- Event-driven monitoring with transition tracking
- Confidence scoring validation
- Evidence hash integrity checking

### üöÄ Enhanced CLI

- Improved user interface with better formatting
- Detailed error reporting with suggestions
- Comprehensive schema information display
- Better performance metrics

### üîß Integration Enhancements

- CI/CD pipeline integration helpers
- Automated test runner with discovery
- Batch validation capabilities
- Real-time monitoring integration

### üí™ Code Quality Improvements

- Complete type annotation coverage
- Enhanced error handling
- Better code formatting and documentation
- Improved performance and reliability

## Development

### Running Tests

```bash
# Install development dependencies
uv sync --dev

# Run validation tests  
python -m src.csv_schema_validator.cli info --schema-type seller
python -m src.csv_schema_validator.cli info --schema-type listing

# Test validation functionality
python -c "
from src.csv_schema_validator.validators import CSVSchemaValidator
from src.csv_schema_validator.schemas import SELLER_SCHEMA
validator = CSVSchemaValidator(SELLER_SCHEMA)
print('‚úÖ Validation framework operational')
"

# Test monitoring schemas
python -c "
from src.csv_schema_validator.monitoring_schemas import *
print('‚úÖ Monitoring schemas loaded:', len(SELLER_MONITORING_SCHEMA), 'fields')
"

# Code quality checks
uv run mypy csv_schema_validator/ --ignore-missing-imports
uv run black csv_schema_validator/
uv run flake8 csv_schema_validator/
```

### Performance Testing

```bash
# Test with sample data
python -c "
from src.csv_schema_validator.test_runner import SchemaTestRunner
runner = SchemaTestRunner('.')
print('‚úÖ Test runner operational')
"

# Batch validation testing
python -c "  
from src.csv_schema_validator.validators import BatchValidator
batch = BatchValidator()
print('‚úÖ Batch validator operational')
"
```

### Integration Testing

```bash
# Test integration helpers
python -c "
from src.csv_schema_validator.integrations.scrapers import ScraperIntegration
from src.csv_schema_validator.integrations.ci_cd import generate_ci_report
print('‚úÖ Integration helpers operational')
"
```

## Changelog

### Version 1.0.0 (Current)

- ‚úÖ **Added monitoring schemas** for seller monitoring and events
- ‚úÖ **Enhanced CLI interface** with improved UX and error reporting
- ‚úÖ **Improved integration helpers** for CI/CD and scraper workflows
- ‚úÖ **Better type annotations** throughout the codebase
- ‚úÖ **Enhanced error handling** and validation logic
- ‚úÖ **Performance improvements** in batch processing
- ‚úÖ **Code quality improvements** with consistent formatting

### Previous Versions

- **0.1.0** - Initial release with basic seller and listing schemas
- **0.1.1** - Bug fixes and validation improvements
